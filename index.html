<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>MAX LAPS CHALLENGE</title>
    <!-- 
    TO ADD YOUR PARTNER LOGOS:
    1. Save your logo images with these exact names (or update the names in the HTML):
       - independence-run-hike-logo.png
       - wise-bar-logo.png
       - revel-bikes-logo.png
    2. Place all logo files in the same folder as this HTML file
    3. If your files have different names or are in a different folder, update the src="" paths
    4. The logos will automatically display once the files are in place
    5. Until then, placeholder boxes will show the partner names
    -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Strafe-inspired earth tone color palette */
            --primary-black: #000;
            --strafe-amber: #D4A574;
            --strafe-sage: #87A96B;
            --strafe-arctic: #5B9BD5;
            --strafe-stone: #8B8680;
            --strafe-snow: #FAFAFA;
            --hover-amber: #C19660;
            --light-sage: #E8F0E3;
            --light-arctic: #E3F0FA;
            
            /* Additional earth tones */
            --strafe-rust: #A0522D;
            --strafe-terracotta: #C65D00;
            --strafe-forest: #228B22;
            --strafe-olive: #6B8E23;
            --strafe-sand: #E5D4A1;
            --strafe-bark: #8B4513;
            --strafe-moss: #4A5D23;
            --strafe-clay: #B87333;
            --strafe-wheat: #F5DEB3;
            --strafe-sienna: #A0522D;
            
            /* Light pastel backgrounds */
            --pastel-cream: #FFF9F2;
            --pastel-green: #F0F7E8;
            --pastel-peach: #FFF5E6;
            --pastel-sand: #F5F0E8;
            --pastel-ivory: #FFFCF8;
            
            /* Partnership bar color - light neutral that works with all logos */
            --partnership-bg: #F4F1ED;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--primary-black);
            background-color: #FEFDFB;
            font-size: 14px;
            letter-spacing: 0.02em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background-color: var(--pastel-cream);
            border-bottom: 2px solid var(--strafe-amber);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .strafe-logo {
            height: 40px;
            width: auto;
            max-width: 120px;
            display: block;
            object-fit: contain;
        }

        .logo {
            font-size: 24px;
            font-weight: 500;
            letter-spacing: 0.04em;
            color: var(--primary-black);
            text-shadow: none;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-link {
            text-transform: uppercase;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.08em;
            color: var(--primary-black);
            text-decoration: none;
            transition: all 0.3s;
            position: relative;
        }

        .nav-link:hover {
            color: var(--strafe-rust);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--strafe-rust);
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* Hero Section with Image Background */
        .hero {
            background-color: var(--pastel-green);
            padding: 80px 0 100px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* Placeholder for hero image - replace src with your image */
        .hero-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.15;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .partnership-section {
            margin-top: 50px;
            text-align: center;
        }

        .partnership-text {
            font-size: 18px;
            font-weight: 500;
            color: var(--primary-black);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 25px;
            opacity: 0.8;
        }

        /* Fixed Partnership Bar */
        .partner-logos-wrapper {
            background-color: var(--partnership-bg);
            padding: 30px 0;
            margin: 0 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .partner-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            flex-wrap: wrap;
        }

        .partner-logo {
            height: 40px;
            width: auto;
            max-width: 120px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .partner-logo:hover {
            transform: scale(1.05);
        }

        .partner-logo-placeholder {
            height: 40px;
            min-width: 100px;
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            border: 1px dashed #999;
            border-radius: 4px;
            line-height: 1.2;
            text-align: center;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 400;
            letter-spacing: 0.02em;
            margin-bottom: 16px;
            text-transform: uppercase;
            color: var(--primary-black);
            text-shadow: none;
        }

        .hero p {
            font-size: 18px;
            color: var(--primary-black);
            max-width: 600px;
            margin: 0 auto;
            font-weight: 500;
        }

        /* Stats Grid */
        .stats-section {
            padding: 60px 0;
            background-color: var(--pastel-peach);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .stat-card {
            background-color: #FFFBF5;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid var(--strafe-clay);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(184, 115, 51, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(184, 115, 51, 0.2);
            background-color: var(--pastel-cream);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: var(--strafe-terracotta);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--primary-black);
        }

        /* Main Content Grid */
        .main-content {
            padding: 60px 0;
            background-color: var(--pastel-ivory);
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 40px;
        }

        /* Form Section */
        .form-section {
            background-color: var(--pastel-cream);
            border: 1px solid var(--strafe-clay);
            padding: 40px;
            box-shadow: 0 4px 15px rgba(160, 82, 45, 0.1);
        }

        .form-section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 32px;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            color: var(--primary-black);
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 8px;
            color: var(--primary-black);
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--strafe-clay);
            background-color: #FFFDFB;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-black);
            background-color: #fff;
        }

        select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--strafe-clay);
            background-color: #FFFDFB;
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-black);
        }

        .filter-select {
            border: 1px solid var(--strafe-sand);
        }

        .radio-group {
            display: flex;
            gap: 24px;
            margin-top: 12px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-item input[type="radio"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary-black);
        }

        .radio-item label {
            font-size: 14px;
            text-transform: none;
            letter-spacing: normal;
            margin-bottom: 0;
            color: var(--primary-black);
        }

        .btn {
            width: 100%;
            padding: 16px 32px;
            background-color: var(--strafe-terracotta);
            color: #fff;
            border: none;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
            box-shadow: 0 4px 10px rgba(198, 93, 0, 0.3);
        }

        .btn:hover {
            background-color: var(--strafe-rust);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(198, 93, 0, 0.4);
        }

        .btn-secondary {
            background-color: var(--strafe-sage);
            color: #fff;
            border: none;
        }

        .btn-secondary:hover {
            background-color: var(--strafe-olive);
        }

        .btn-small {
            width: auto;
            padding: 12px 24px;
            font-size: 12px;
        }

        /* Table Styles */
        .table-container {
            background-color: var(--pastel-cream);
            border: 1px solid var(--strafe-clay);
            padding: 40px;
            box-shadow: 0 4px 15px rgba(160, 82, 45, 0.1);
        }

        .table-container h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 32px;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            color: var(--primary-black);
        }

        .filter-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--strafe-sand);
            margin-bottom: 24px;
            font-size: 14px;
            background-color: #FFFDFB;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border-bottom: 2px solid var(--primary-black);
            color: var(--primary-black);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--strafe-sand);
            font-size: 14px;
        }

        tr:hover {
            background-color: var(--pastel-peach);
        }

        /* Success/Error Messages */
        .message {
            padding: 16px;
            margin-bottom: 24px;
            font-size: 14px;
            font-weight: 500;
            display: none;
        }

        .success-message {
            background-color: var(--strafe-forest);
            color: #fff;
        }

        .error-message {
            background-color: var(--strafe-rust);
            color: #fff;
        }

        /* Admin Section */
        .admin-section {
            display: none;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .codes-display {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
            margin-top: 24px;
        }

        .code-item {
            background-color: var(--strafe-terracotta);
            color: #fff;
            padding: 16px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 3px 8px rgba(160, 82, 45, 0.3);
        }

        .code-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(160, 82, 45, 0.4);
            background-color: var(--strafe-rust);
        }

        .code-item.used {
            background-color: var(--strafe-stone);
            cursor: default;
        }

        .code-item.used::after {
            content: attr(data-used-date);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            line-height: 1.3;
            padding: 4px;
            font-weight: 400;
        }

        .violations-list {
            background-color: var(--pastel-peach);
            padding: 24px;
            margin-top: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .violation-item {
            padding: 16px;
            margin-bottom: 12px;
            background-color: #FFFFFF;
            border-left: 4px solid var(--strafe-rust);
            font-size: 13px;
        }

        /* Category Leaderboards */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 24px;
        }

        .category-section {
            background-color: var(--pastel-peach);
            padding: 24px;
            border: 1px solid var(--strafe-clay);
            box-shadow: 0 3px 10px rgba(184, 115, 51, 0.1);
        }

        .category-section h3 {
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            margin-bottom: 16px;
            color: var(--primary-black);
        }

        .category-entry {
            padding: 12px;
            margin-bottom: 8px;
            background-color: #FFFFFF;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .category-entry:nth-child(1) {
            border-left: 4px solid #FFD700;
        }

        .category-entry:nth-child(2) {
            border-left: 4px solid #C0C0C0;
        }

        .category-entry:nth-child(3) {
            border-left: 4px solid #CD7F32;
        }

        .entry-count {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--strafe-terracotta);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background-color: var(--pastel-cream);
            margin: 10% auto;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            border: 2px solid var(--strafe-clay);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            font-size: 24px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            margin-bottom: 32px;
            color: var(--primary-black);
        }

        .close {
            float: right;
            font-size: 24px;
            font-weight: 300;
            cursor: pointer;
            line-height: 1;
            color: var(--primary-black);
        }

        .close:hover {
            opacity: 0.6;
        }

        /* Fixed Admin Button */
        .admin-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--strafe-bark);
            color: #fff;
            padding: 12px 24px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(139, 69, 19, 0.4);
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 69, 19, 0.5);
            background-color: var(--strafe-sienna);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--strafe-stone);
            font-style: italic;
        }

        /* Enhanced leaderboard section styling */
        .leaderboard-full {
            background-color: var(--pastel-sand);
        }

        @media (max-width: 768px) {
            /* Stack navigation */
            .nav-bar {
                flex-direction: column;
                gap: 16px;
                padding: 16px 0;
            }

            .nav-left {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .strafe-logo {
                height: 35px;
                width: auto;
                max-width: 100px;
            }

            .nav-links {
                gap: 20px;
            }

            /* Responsive typography */
            .hero h1 {
                font-size: 32px;
            }

            .hero p {
                font-size: 14px;
                padding: 0 20px;
            }

            .stat-value {
                font-size: 32px;
            }

            /* Stack content grid */
            .content-grid,
            .admin-grid,
            .category-grid {
                grid-template-columns: 1fr;
            }

            /* Form improvements for mobile */
            .form-section {
                padding: 24px;
            }

            .form-section h2 {
                font-size: 20px;
            }

            /* Larger touch targets */
            input[type="text"],
            input[type="password"],
            select {
                padding: 16px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .btn {
                padding: 18px 32px;
                font-size: 16px;
            }

            .radio-item input[type="radio"] {
                width: 20px;
                height: 20px;
            }

            /* Table responsiveness */
            .table-container {
                padding: 24px;
                overflow-x: auto;
            }

            table {
                min-width: 500px;
            }

            th, td {
                padding: 12px 8px;
                font-size: 13px;
            }

            /* Stats grid mobile */
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }

            .stat-card {
                padding: 24px 16px;
            }

            /* Filter dropdowns side by side */
            .filter-group {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            /* Modal adjustments */
            .modal-content {
                width: 95%;
                padding: 24px;
                margin: 20% auto;
            }

            /* Fixed admin button */
            .admin-btn {
                bottom: 20px;
                right: 20px;
                padding: 10px 20px;
                font-size: 11px;
            }

            /* Code display grid */
            .codes-display {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
            }

            .code-item {
                padding: 12px 4px;
                font-size: 14px;
            }

            /* Reduce padding on hero */
            .hero {
                padding: 40px 0 50px 0;
            }

            .stats-section {
                padding: 40px 0;
            }

            .main-content {
                padding: 40px 0;
            }

            /* Category sections */
            .category-section {
                padding: 20px;
            }

            .category-section h3 {
                font-size: 14px;
            }

            /* Partnership section mobile */
            .partnership-section {
                margin-top: 30px;
            }

            .partnership-text {
                font-size: 16px;
                margin-bottom: 20px;
            }

            .partner-logos-wrapper {
                margin: 0 20px;
                padding: 20px 0;
            }

            .partner-logos {
                gap: 30px;
            }

            .partner-logo {
                height: 35px;
                max-width: 100px;
            }

            .partner-logo-placeholder {
                height: 35px;
                min-width: 80px;
                font-size: 10px;
                padding: 8px 15px;
            }

            /* Container padding */
            .container {
                padding: 0 16px;
            }
        }

        /* Extra small devices */
        @media (max-width: 375px) {
            .stat-value {
                font-size: 24px;
            }

            .hero h1 {
                font-size: 28px;
            }

            .nav-links {
                font-size: 12px;
            }

            .logo {
                font-size: 20px;
            }

            .partner-logos-wrapper {
                margin: 0 10px;
            }
        }

        /* Landscape orientation improvements */
        @media (max-width: 768px) and (orientation: landscape) {
            .hero {
                padding: 30px 0;
            }

            .hero h1 {
                font-size: 28px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 24px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Larger tap targets for touch devices */
            .nav-link {
                padding: 8px 12px;
            }

            .radio-item {
                padding: 8px 0;
            }

            .code-item {
                min-height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Disable hover effects on touch devices */
            tr:hover {
                background-color: transparent;
            }

            .code-item:hover {
                background-color: var(--strafe-terracotta);
            }

            .code-item.used:hover {
                background-color: var(--strafe-stone);
            }

            .partner-logo:hover {
                transform: none;
            }
        }

        /* iOS specific fixes */
        @supports (-webkit-touch-callout: none) {
            /* Prevent double-tap zoom */
            input, button, select, textarea {
                touch-action: manipulation;
            }
        }
    </style>
</head>
<body>
    <!-- Main Section -->
    <div id="mainSection">
        <header class="header">
            <div class="container">
                <nav class="nav-bar">
                    <div class="nav-left">
                        <!-- Strafe Outerwear Logo -->
                        <svg class="strafe-logo" xmlns="http://www.w3.org/2000/svg" viewBox="60 155 385 50" preserveAspectRatio="xMidYMid meet">
                            <g>
                                <path style="fill:#000000;" d="M 95.949219 169.597656 C 90.949219 176.640625 86.75 182.46875 86.625 182.546875 C 86.5 182.625 85.304688 181.425781 83.976562 179.878906 L 81.558594 177.070312 L 80.945312 177.875 C 80.089844 178.988281 63.460938 202.355469 63.132812 202.902344 C 62.917969 203.253906 65.164062 203.34375 73.921875 203.332031 L 84.980469 203.316406 L 90.09375 196.054688 C 92.90625 192.058594 95.25 188.792969 95.304688 188.792969 C 95.359375 188.792969 95.984375 189.4375 96.691406 190.222656 C 97.398438 191.011719 98.105469 191.609375 98.261719 191.554688 C 98.414062 191.5 100.839844 188.214844 103.652344 184.253906 L 108.757812 177.054688 L 118.730469 190.199219 L 128.703125 203.347656 L 134.480469 203.347656 C 137.660156 203.347656 140.261719 203.257812 140.261719 203.148438 C 140.261719 202.910156 106.546875 158.378906 105.660156 157.441406 C 105.070312 156.820312 104.660156 157.335938 95.949219 169.597656 M 167.1875 162.550781 C 162.03125 163.351562 158.34375 165.660156 156.632812 169.160156 C 155.765625 170.9375 155.625 171.640625 155.625 174.238281 C 155.625 176.824219 155.769531 177.546875 156.617188 179.28125 C 158.769531 183.683594 162.558594 185.464844 173.085938 187.011719 C 178.769531 187.847656 180.140625 188.207031 181.371094 189.179688 C 182.351562 189.953125 182.601562 191.460938 181.953125 192.675781 C 180.96875 194.523438 173.335938 195.320312 169.375 193.992188 C 167.457031 193.347656 165.613281 191.710938 165.015625 190.125 L 164.652344 189.148438 L 154.390625 189.148438 L 154.390625 189.996094 C 154.390625 191.589844 155.800781 195.355469 157.023438 197.015625 C 159.347656 200.179688 162.902344 201.984375 168.488281 202.828125 C 174.351562 203.71875 181.132812 203.328125 184.96875 201.886719 C 187.808594 200.820312 190.167969 198.785156 191.324219 196.410156 C 192.167969 194.679688 192.300781 193.96875 192.300781 191.277344 C 192.300781 188.59375 192.167969 187.875 191.335938 186.171875 C 189.28125 181.949219 185.300781 179.917969 176.289062 178.488281 C 166.695312 176.964844 164.695312 175.984375 165.714844 173.292969 C 166.542969 171.105469 173.570312 170.039062 177.429688 171.519531 C 179.101562 172.164062 180.882812 173.851562 180.882812 174.800781 C 180.882812 175.214844 181.832031 175.304688 186.171875 175.304688 L 191.460938 175.304688 L 191.261719 174.148438 C 190.246094 168.308594 186.859375 164.761719 180.691406 163.074219 C 178.128906 162.375 170.277344 162.070312 167.1875 162.550781 M 202.78125 167.496094 L 202.78125 172.109375 L 217.265625 172.109375 L 217.265625 202.636719 L 227.152344 202.636719 L 227.152344 172.109375 L 241.636719 172.109375 L 241.636719 162.878906 L 202.78125 162.878906 Z M 255.410156 182.730469 L 255.410156 202.636719 L 265.300781 202.636719 L 265.300781 171.691406 L 272.632812 171.816406 C 280.894531 171.953125 281.890625 172.210938 282.8125 174.429688 C 283.796875 176.792969 283.136719 179.035156 281.089844 180.289062 C 280.085938 180.902344 279.289062 180.980469 273.867188 180.980469 L 267.773438 180.984375 L 267.773438 189.859375 L 274.664062 189.867188 L 278.234375 196.164062 L 281.808594 202.457031 L 287.152344 202.554688 C 290.785156 202.625 292.5 202.53125 292.5 202.273438 C 292.5 202.0625 290.828125 198.984375 288.78125 195.429688 C 285.527344 189.773438 285.136719 188.925781 285.652344 188.613281 C 291.457031 185.113281 293.542969 181.421875 293.109375 175.398438 C 292.796875 171.023438 290.996094 167.726562 287.753906 165.585938 C 284.035156 163.132812 283.886719 163.113281 268.921875 162.964844 L 255.410156 162.828125 Z M 318.683594 163.503906 C 318.449219 163.945312 306.480469 193.839844 303.195312 202.191406 C 303.0625 202.535156 304.226562 202.636719 308.34375 202.636719 C 313.058594 202.636719 313.707031 202.566406 313.992188 202.015625 C 314.167969 201.671875 316.65625 195.402344 319.523438 188.082031 C 322.390625 180.761719 324.84375 174.648438 324.976562 174.5 C 325.109375 174.351562 326.21875 176.746094 327.441406 179.824219 C 328.664062 182.902344 329.742188 185.621094 329.839844 185.863281 C 329.976562 186.203125 329.175781 186.308594 326.507812 186.308594 L 323 186.308594 L 321.347656 190.484375 C 320.441406 192.78125 319.699219 194.773438 319.699219 194.914062 C 319.699219 195.054688 322.816406 195.210938 326.628906 195.261719 L 333.558594 195.359375 L 334.953125 198.996094 L 336.351562 202.636719 L 341.625 202.636719 C 344.886719 202.636719 346.894531 202.5 346.894531 202.28125 C 346.894531 201.957031 332.679688 166.042969 331.683594 163.855469 L 331.242188 162.878906 L 325.128906 162.878906 C 319.667969 162.878906 318.980469 162.945312 318.683594 163.503906 M 359.613281 182.757812 L 359.613281 202.636719 L 369.503906 202.636719 L 369.503906 187.726562 L 391.050781 187.726562 L 391.050781 179.207031 L 369.503906 179.207031 L 369.503906 171.753906 L 393.167969 171.753906 L 393.167969 162.878906 L 359.613281 162.878906 Z M 407.296875 182.757812 L 407.296875 202.636719 L 440.851562 202.636719 L 440.851562 193.40625 L 417.1875 193.40625 L 417.1875 186.664062 L 438.734375 186.664062 L 438.734375 178.144531 L 417.1875 178.144531 L 417.1875 171.753906 L 440.851562 171.753906 L 440.851562 162.878906 L 407.296875 162.878906 Z M 407.296875 182.757812 "/>
                            </g>
                        </svg>
                        <div class="logo">MAX LAPS CHALLENGE</div>
                    </div>
                    <div class="nav-links">
                        <a href="#submit" class="nav-link">SUBMIT</a>
                        <a href="#leaderboard" class="nav-link">LEADERBOARD</a>
                    </div>
                </nav>
            </div>
        </header>

        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>TRACK YOUR LAP</h1>
                    <p>Congratulations on reaching the summit! You're one lap closer to winning amazing prizes.</p>
                    
                    <!-- Partnership Section -->
                    <div class="partnership-section">
                        <p class="partnership-text">In Partnership With</p>
                        <div class="partner-logos-wrapper">
                            <div class="partner-logos">
                                <!-- Independence Run & Hike Logo -->
                                <img src="independence-run-hike-logo.png" alt="Independence Run & Hike" class="partner-logo" onerror="this.outerHTML='<div class=\'partner-logo-placeholder\'>Independence<br>Run & Hike</div>'">
                                
                                <!-- Wise Bar Logo -->
                                <img src="wise-bar-logo.png" alt="Wise Bar" class="partner-logo" onerror="this.outerHTML='<div class=\'partner-logo-placeholder\'>Wise Bar</div>'">
                                
                                <!-- Revel Bikes Logo -->
                                <img src="revel-bikes-logo.png" alt="Revel Bikes" class="partner-logo" onerror="this.outerHTML='<div class=\'partner-logo-placeholder\'>Revel Bikes</div>'">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPlayers">0</div>
                        <div class="stat-label">Total Entries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="highestScore">0 / 0</div>
                        <div class="stat-label">Bikes / Running</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="averageScore">0M / 0F</div>
                        <div class="stat-label">Gender Split</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todaySubmissions">0</div>
                        <div class="stat-label">Today's Entries</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="main-content" id="submit">
            <div class="container">
                <div class="content-grid">
                    <div class="form-section">
                        <h2>Submit Entry</h2>
                        
                        <div class="success-message message" id="successMessage">
                            ENTRY SUBMITTED SUCCESSFULLY
                        </div>

                        <form id="scoreForm">
                            <div class="form-group">
                                <label for="playerName">Name</label>
                                <input type="text" id="playerName" required placeholder="Enter your name">
                            </div>

                            <div class="form-group">
                                <label for="dailyCode">Summit Code</label>
                                <input type="text" id="dailyCode" required placeholder="3-digit code">
                            </div>

                            <div class="form-group">
                                <label>Gender</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="male" name="gender" value="Male" required>
                                        <label for="male">Male</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="female" name="gender" value="Female" required>
                                        <label for="female">Female</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Method</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="foot" name="method" value="Running" required>
                                        <label for="foot">Running</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="cycle" name="method" value="Biking" required>
                                        <label for="cycle">Biking</label>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn">SUBMIT ENTRY</button>
                        </form>
                    </div>

                    <div class="table-container">
                        <h2>Recent Entries</h2>
                        
                        <input type="text" class="filter-input" id="searchInput" placeholder="Search by name..." onkeyup="filterLeaderboard()">

                        <div id="leaderboardContent">
                            <div class="no-data">No entries yet. Be the first to submit!</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="leaderboard-full" id="leaderboard" style="padding: 60px 0;">
            <div class="container">
                <div class="form-section" style="max-width: 100%;">
                    <h2>LEADERBOARD</h2>
                    
                    <div style="display: flex; gap: 16px; margin-bottom: 32px;" class="filter-group">
                        <div class="form-group" style="margin: 0; flex: 1;">
                            <label for="methodFilter">Method</label>
                            <select id="methodFilter" class="filter-select" onchange="filterFullLeaderboard()">
                                <option value="all">All Methods</option>
                                <option value="Running">Running</option>
                                <option value="Biking">Biking</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0; flex: 1;">
                            <label for="genderFilter">Gender</label>
                            <select id="genderFilter" class="filter-select" onchange="filterFullLeaderboard()">
                                <option value="all">All Genders</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>

                    <div id="fullLeaderboardContent">
                        <div class="no-data">No entries yet.</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Admin Section -->
    <div id="adminSection" class="admin-section">
        <header class="header">
            <div class="container">
                <nav class="nav-bar">
                    <div class="nav-left">
                        <!-- Strafe Outerwear Logo -->
                        <svg class="strafe-logo" xmlns="http://www.w3.org/2000/svg" viewBox="60 155 385 50" preserveAspectRatio="xMidYMid meet">
                            <g>
                                <path style="fill:#000000;" d="M 95.949219 169.597656 C 90.949219 176.640625 86.75 182.46875 86.625 182.546875 C 86.5 182.625 85.304688 181.425781 83.976562 179.878906 L 81.558594 177.070312 L 80.945312 177.875 C 80.089844 178.988281 63.460938 202.355469 63.132812 202.902344 C 62.917969 203.253906 65.164062 203.34375 73.921875 203.332031 L 84.980469 203.316406 L 90.09375 196.054688 C 92.90625 192.058594 95.25 188.792969 95.304688 188.792969 C 95.359375 188.792969 95.984375 189.4375 96.691406 190.222656 C 97.398438 191.011719 98.105469 191.609375 98.261719 191.554688 C 98.414062 191.5 100.839844 188.214844 103.652344 184.253906 L 108.757812 177.054688 L 118.730469 190.199219 L 128.703125 203.347656 L 134.480469 203.347656 C 137.660156 203.347656 140.261719 203.257812 140.261719 203.148438 C 140.261719 202.910156 106.546875 158.378906 105.660156 157.441406 C 105.070312 156.820312 104.660156 157.335938 95.949219 169.597656 M 167.1875 162.550781 C 162.03125 163.351562 158.34375 165.660156 156.632812 169.160156 C 155.765625 170.9375 155.625 171.640625 155.625 174.238281 C 155.625 176.824219 155.769531 177.546875 156.617188 179.28125 C 158.769531 183.683594 162.558594 185.464844 173.085938 187.011719 C 178.769531 187.847656 180.140625 188.207031 181.371094 189.179688 C 182.351562 189.953125 182.601562 191.460938 181.953125 192.675781 C 180.96875 194.523438 173.335938 195.320312 169.375 193.992188 C 167.457031 193.347656 165.613281 191.710938 165.015625 190.125 L 164.652344 189.148438 L 154.390625 189.148438 L 154.390625 189.996094 C 154.390625 191.589844 155.800781 195.355469 157.023438 197.015625 C 159.347656 200.179688 162.902344 201.984375 168.488281 202.828125 C 174.351562 203.71875 181.132812 203.328125 184.96875 201.886719 C 187.808594 200.820312 190.167969 198.785156 191.324219 196.410156 C 192.167969 194.679688 192.300781 193.96875 192.300781 191.277344 C 192.300781 188.59375 192.167969 187.875 191.335938 186.171875 C 189.28125 181.949219 185.300781 179.917969 176.289062 178.488281 C 166.695312 176.964844 164.695312 175.984375 165.714844 173.292969 C 166.542969 171.105469 173.570312 170.039062 177.429688 171.519531 C 179.101562 172.164062 180.882812 173.851562 180.882812 174.800781 C 180.882812 175.214844 181.832031 175.304688 186.171875 175.304688 L 191.460938 175.304688 L 191.261719 174.148438 C 190.246094 168.308594 186.859375 164.761719 180.691406 163.074219 C 178.128906 162.375 170.277344 162.070312 167.1875 162.550781 M 202.78125 167.496094 L 202.78125 172.109375 L 217.265625 172.109375 L 217.265625 202.636719 L 227.152344 202.636719 L 227.152344 172.109375 L 241.636719 172.109375 L 241.636719 162.878906 L 202.78125 162.878906 Z M 255.410156 182.730469 L 255.410156 202.636719 L 265.300781 202.636719 L 265.300781 171.691406 L 272.632812 171.816406 C 280.894531 171.953125 281.890625 172.210938 282.8125 174.429688 C 283.796875 176.792969 283.136719 179.035156 281.089844 180.289062 C 280.085938 180.902344 279.289062 180.980469 273.867188 180.980469 L 267.773438 180.984375 L 267.773438 189.859375 L 274.664062 189.867188 L 278.234375 196.164062 L 281.808594 202.457031 L 287.152344 202.554688 C 290.785156 202.625 292.5 202.53125 292.5 202.273438 C 292.5 202.0625 290.828125 198.984375 288.78125 195.429688 C 285.527344 189.773438 285.136719 188.925781 285.652344 188.613281 C 291.457031 185.113281 293.542969 181.421875 293.109375 175.398438 C 292.796875 171.023438 290.996094 167.726562 287.753906 165.585938 C 284.035156 163.132812 283.886719 163.113281 268.921875 162.964844 L 255.410156 162.828125 Z M 318.683594 163.503906 C 318.449219 163.945312 306.480469 193.839844 303.195312 202.191406 C 303.0625 202.535156 304.226562 202.636719 308.34375 202.636719 C 313.058594 202.636719 313.707031 202.566406 313.992188 202.015625 C 314.167969 201.671875 316.65625 195.402344 319.523438 188.082031 C 322.390625 180.761719 324.84375 174.648438 324.976562 174.5 C 325.109375 174.351562 326.21875 176.746094 327.441406 179.824219 C 328.664062 182.902344 329.742188 185.621094 329.839844 185.863281 C 329.976562 186.203125 329.175781 186.308594 326.507812 186.308594 L 323 186.308594 L 321.347656 190.484375 C 320.441406 192.78125 319.699219 194.773438 319.699219 194.914062 C 319.699219 195.054688 322.816406 195.210938 326.628906 195.261719 L 333.558594 195.359375 L 334.953125 198.996094 L 336.351562 202.636719 L 341.625 202.636719 C 344.886719 202.636719 346.894531 202.5 346.894531 202.28125 C 346.894531 201.957031 332.679688 166.042969 331.683594 163.855469 L 331.242188 162.878906 L 325.128906 162.878906 C 319.667969 162.878906 318.980469 162.945312 318.683594 163.503906 M 359.613281 182.757812 L 359.613281 202.636719 L 369.503906 202.636719 L 369.503906 187.726562 L 391.050781 187.726562 L 391.050781 179.207031 L 369.503906 179.207031 L 369.503906 171.753906 L 393.167969 171.753906 L 393.167969 162.878906 L 359.613281 162.878906 Z M 407.296875 182.757812 L 407.296875 202.636719 L 440.851562 202.636719 L 440.851562 193.40625 L 417.1875 193.40625 L 417.1875 186.664062 L 438.734375 186.664062 L 438.734375 178.144531 L 417.1875 178.144531 L 417.1875 171.753906 L 440.851562 171.753906 L 440.851562 162.878906 L 407.296875 162.878906 Z M 407.296875 182.757812 "/>
                            </g>
                        </svg>
                        <div class="logo">MAX LAPS CHALLENGE ADMIN</div>
                    </div>
                    <div class="nav-links">
                        <a href="#" class="nav-link" onclick="backToMain()">‚Üê BACK TO MAIN</a>
                    </div>
                </nav>
            </div>
        </header>

        <section class="main-content">
            <div class="container">
                <div class="form-section" style="margin-bottom: 40px;">
                    <h2>Category Leaders</h2>
                    <div class="category-grid">
                        <div class="category-section">
                            <h3>Male - Running</h3>
                            <div id="maleFoot"></div>
                        </div>
                        <div class="category-section">
                            <h3>Female - Running</h3>
                            <div id="femaleFoot"></div>
                        </div>
                        <div class="category-section">
                            <h3>Male - Biking</h3>
                            <div id="maleCycle"></div>
                        </div>
                        <div class="category-section">
                            <h3>Female - Biking</h3>
                            <div id="femaleCycle"></div>
                        </div>
                    </div>
                </div>

                <div class="admin-grid">
                    <div class="form-section">
                        <h2>Summit Codes</h2>
                        <p style="margin-bottom: 16px; color: var(--strafe-stone);">Click to activate/deactivate codes</p>
                        <p style="margin-bottom: 16px;">Active codes: <strong id="activeCodeCount">0</strong></p>
                        <div class="codes-display" id="codesDisplay"></div>
                        <button class="btn btn-secondary btn-small" style="margin-top: 24px;" onclick="clearActiveCodes()">CLEAR ALL ACTIVE</button>
                    </div>

                    <div class="form-section">
                        <h2>Code Violations</h2>
                        <div class="stat-card" style="margin-bottom: 24px;">
                            <div class="stat-value" id="violationCount">0</div>
                            <div class="stat-label">Total Violations</div>
                        </div>
                        <div id="violationsContent">
                            <div class="no-data">No violations recorded yet.</div>
                        </div>
                    </div>
                </div>

                <div class="form-section" style="margin-top: 40px;">
                    <h2>Admin Actions</h2>
                    <div style="display: flex; gap: 16px;">
                        <button class="btn btn-secondary btn-small" onclick="clearAllData()">CLEAR ALL DATA</button>
                        <button class="btn btn-small" onclick="exportData()">EXPORT DATA</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Admin Access</h2>
            <div class="error-message message" id="loginError">Incorrect password</div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required>
                </div>
                <button type="submit" class="btn">ACCESS ADMIN</button>
            </form>
        </div>
    </div>

    <!-- Admin Button -->
    <button class="admin-btn" onclick="showPasswordModal()">ADMIN</button>

    <script>
        // IMPORTANT: Replace this with your Google Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwP7bk8o8uZ0Dg6Y-Z7y4G28VptqbWWRqSNc0cM4GIiH1JCkn85YmMuDo7t0tMwnyNufA/exec';
        
        // Initialize data
        let leaderboardData = [];
        let codeViolations = [];
        let usedCodes = {};
        const ADMIN_PASSWORD = "mountain2024";

        // Fixed 30 unique 3-digit codes for Max Laps Challenge
        const uniqueDailyCodes = [
            "101", "237", "456", "789", "234",
            "567", "890", "123", "345", "678",
            "912", "415", "628", "901", "254",
            "573", "896", "142", "467", "785",
            "023", "356", "689", "914", "247",
            "568", "892", "135", "469", "999"
        ];
// Load data from Google Sheets
async function loadData() {
    try {
        // Show loading state
        document.getElementById('leaderboardContent').innerHTML = '<div class="no-data">Loading entries...</div>';
        
        console.log('Loading data from:', `${SCRIPT_URL}?action=getAll`);
        
        // Get entries
        const entriesResponse = await fetch(`${SCRIPT_URL}?action=getAll`);
        const entriesText = await entriesResponse.text();
        console.log('Raw response:', entriesText);
        
        let entriesData;
        try {
            entriesData = JSON.parse(entriesText);
            console.log('Parsed data:', entriesData);
        } catch (e) {
            console.error('Failed to parse JSON:', e);
            console.log('Response was:', entriesText);
            document.getElementById('leaderboardContent').innerHTML = '<div class="no-data">Error: Invalid data format from server.</div>';
            return;
        }
        
        if (entriesData.success && entriesData.entries) {
            console.log('Number of entries found:', entriesData.entries.length);
            console.log('First entry:', entriesData.entries[0]);
            
            // FIXED: Parse each entry properly
            leaderboardData = entriesData.entries.map(entry => {
                // Handle the case where entry might be an array from Google Sheets
                if (Array.isArray(entry)) {
                    return {
                        id: entry[0],
                        name: entry[1],
                        dailyCode: entry[2],
                        gender: entry[3],
                        method: entry[4],
                        date: entry[5],
                        submissionTime: entry[6]
                    };
                }
                // If it's already an object, return as is
                return entry;
            }).filter(entry => entry && entry.name); // Filter out empty entries
            
            console.log('Processed entries:', leaderboardData);
            
            displayLeaderboard();
            displayFullLeaderboard();
            updateStatistics();
        } else {
            console.log('No success or entries in response');
            document.getElementById('leaderboardContent').innerHTML = '<div class="no-data">No entries found.</div>';
        }
        
        // Get violations (keeping the existing code for violations)
        try {
            const violationsResponse = await fetch(`${SCRIPT_URL}?action=getViolations`);
            const violationsData = await violationsResponse.json();
            
            if (violationsData.success && violationsData.violations) {
                codeViolations = violationsData.violations.map(violation => {
                    if (Array.isArray(violation)) {
                        return {
                            name: violation[0],
                            attemptedCode: violation[1],
                            date: violation[2],
                            time: violation[3],
                            type: violation[4]
                        };
                    }
                    return violation;
                }).filter(v => v && v.name);
                
                updateStatistics();
                displayViolations();
            }
        } catch (e) {
            console.log('Error loading violations:', e);
        }
        
        // Get active codes (keeping the existing code)
        try {
            const codesResponse = await fetch(`${SCRIPT_URL}?action=getActiveCodes`);
            const codesData = await codesResponse.json();
            
            if (codesData.success && codesData.activeCodes) {
                usedCodes = codesData.activeCodes || {};
            }
        } catch (e) {
            console.log('Error loading active codes:', e);
        }
    } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('leaderboardContent').innerHTML = '<div class="no-data">Error loading data. Please check console for details.</div>';
    }
    
    // Always display codes after loading
    displayCodes();
}
       
                        // Handle array format from Google Sheets
                        if (Array.isArray(violation)) {
                            return {
                                name: violation[0],
                                attemptedCode: violation[1],
                                date: violation[2],
                                time: violation[3],
                                type: violation[4]
                            };
                        }
                        return violation;
                    }).filter(v => v && v.name);
                    
                    updateStatistics();
                    displayViolations();
                }
                
                // Get active codes
                const codesResponse = await fetch(`${SCRIPT_URL}?action=getActiveCodes`);
                const codesData = await codesResponse.json();
                
                if (codesData.success && codesData.activeCodes) {
                    usedCodes = codesData.activeCodes || {};
                }
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('leaderboardContent').innerHTML = '<div class="no-data">Error loading data. Please refresh the page.</div>';
            }
            
            // Always display codes after loading
            displayCodes();
        }

        // Save entry to Google Sheets using GET request as workaround for CORS
        async function saveEntry(entry) {
            try {
                // Use GET request with parameters to bypass CORS issues
                const params = new URLSearchParams({
                    action: 'submit',
                    name: entry.name,
                    dailyCode: entry.dailyCode,
                    gender: entry.gender,
                    method: entry.method,
                    submissionTime: entry.submissionTime,
                    id: entry.id
                });
                
                const response = await fetch(`${SCRIPT_URL}?${params}`);
                const result = await response.text();
                console.log('Save result:', result);
                
                // Add to local data
                leaderboardData.push(entry);
                leaderboardData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                displayLeaderboard();
                displayFullLeaderboard();
                updateStatistics();
            } catch (error) {
                console.error('Error saving entry:', error);
                // Still add locally even if save fails
                leaderboardData.push(entry);
                leaderboardData.sort((a, b) => new Date(b.date) - new Date(a.date));
                displayLeaderboard();
                displayFullLeaderboard();
                updateStatistics();
            }
        }

        // Save violation to Google Sheets
        async function saveViolation(violation) {
            try {
                const params = new URLSearchParams({
                    action: 'saveViolation',
                    name: violation.name,
                    attemptedCode: violation.attemptedCode,
                    time: violation.time,
                    type: violation.type || 'invalid'
                });
                
                await fetch(`${SCRIPT_URL}?${params}`);
                
                codeViolations.push(violation);
                updateStatistics();
                displayViolations();
            } catch (error) {
                console.error('Error saving violation:', error);
                codeViolations.push(violation);
                updateStatistics();
                displayViolations();
            }
        }

        // Load data when page loads
        window.addEventListener('load', function() {
            if (SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                alert('Please update the SCRIPT_URL with your Google Apps Script URL!');
                displayLeaderboard();
                updateStatistics();
                displayCodes();
                displayFullLeaderboard();
            } else {
                loadData();
            }
        });

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Handle form submission
        document.getElementById('scoreForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const playerName = document.getElementById('playerName').value.trim();
            const dailyCode = document.getElementById('dailyCode').value.trim().toUpperCase();
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const method = document.querySelector('input[name="method"]:checked').value;

            // Validate daily code
            const isValidCode = uniqueDailyCodes.includes(dailyCode);
            const isActiveCode = Object.keys(usedCodes).includes(dailyCode);

            if (!isValidCode) {
                const violation = {
                    name: playerName,
                    attemptedCode: dailyCode,
                    date: new Date().toISOString(),
                    time: new Date().toLocaleTimeString()
                };
                await saveViolation(violation);

                alert(`Invalid code: "${dailyCode}"`);
                document.getElementById('dailyCode').value = '';
                return;
            }

            if (!isActiveCode) {
                const violation = {
                    name: playerName,
                    attemptedCode: dailyCode,
                    date: new Date().toISOString(),
                    time: new Date().toLocaleTimeString(),
                    type: 'inactive'
                };
                await saveViolation(violation);

                alert(`Code "${dailyCode}" is not active today.`);
                document.getElementById('dailyCode').value = '';
                return;
            }

            const entry = {
                id: Date.now(),
                name: playerName,
                dailyCode: dailyCode,
                gender: gender,
                method: method,
                date: new Date().toISOString(),
                submissionTime: new Date().toLocaleTimeString()
            };

            // Save to Google Sheets
            await saveEntry(entry);

            const successMsg = document.getElementById('successMessage');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);

            this.reset();
        });

        // Display leaderboard
        function displayLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            
            if (!leaderboardData || leaderboardData.length === 0) {
                content.innerHTML = '<div class="no-data">No entries yet. Be the first to submit!</div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Entry</th>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Method</th>
                            <th>Date</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            leaderboardData.forEach((entry, index) => {
                // Check if entry exists and has the required properties
                if (!entry) return;
                
                const entryNum = index + 1;
                const name = entry.name || 'Unknown';
                const gender = entry.gender || 'Unknown';
                const method = entry.method || 'Unknown';
                
                // Handle date with fallback
                let date = 'Unknown';
                let time = 'Unknown';
                
                if (entry.date) {
                    try {
                        const dateObj = new Date(entry.date);
                        if (!isNaN(dateObj.getTime())) {
                            date = dateObj.toLocaleDateString();
                            time = entry.submissionTime || dateObj.toLocaleTimeString();
                        }
                    } catch (e) {
                        console.error('Date parsing error:', e);
                    }
                }

                html += `
                    <tr>
                        <td>${entryNum}</td>
                        <td>${name}</td>
                        <td>${gender}</td>
                        <td>${method}</td>
                        <td>${date}</td>
                        <td>${time}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // Update statistics
        function updateStatistics() {
            const totalEntries = leaderboardData.length;
            const bikeCount = leaderboardData.filter(entry => entry && entry.method === 'Biking').length;
            const runCount = leaderboardData.filter(entry => entry && entry.method === 'Running').length;
            const maleCount = leaderboardData.filter(entry => entry && entry.gender === 'Male').length;
            const femaleCount = leaderboardData.filter(entry => entry && entry.gender === 'Female').length;
            
            const today = new Date().toDateString();
            const todaySubmissions = leaderboardData.filter(entry => {
                if (!entry || !entry.date) return false;
                try {
                    return new Date(entry.date).toDateString() === today;
                } catch (e) {
                    return false;
                }
            }).length;

            document.getElementById('totalPlayers').textContent = totalEntries;
            document.getElementById('highestScore').textContent = `${bikeCount} / ${runCount}`;
            document.getElementById('averageScore').textContent = `${maleCount}M / ${femaleCount}F`;
            document.getElementById('todaySubmissions').textContent = todaySubmissions;
            document.getElementById('violationCount').textContent = codeViolations.length;
        }

        // Filter leaderboard
        function filterLeaderboard() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = leaderboardData.filter(entry => {
                // Check if entry and entry.name exist before using toLowerCase
                if (!entry || !entry.name) return false;
                return entry.name.toLowerCase().includes(searchTerm);
            });

            const originalData = [...leaderboardData];
            leaderboardData = filteredData;
            displayLeaderboard();
            leaderboardData = originalData;
        }

        // Display full leaderboard with filters
        function displayFullLeaderboard() {
            const methodFilter = document.getElementById('methodFilter')?.value || 'all';
            const genderFilter = document.getElementById('genderFilter')?.value || 'all';
            
            // Count entries per person
            const personCounts = {};
            
            leaderboardData.forEach(entry => {
                if (!entry || !entry.name) return;
                
                // Apply filters
                if (methodFilter !== 'all' && entry.method !== methodFilter) return;
                if (genderFilter !== 'all' && entry.gender !== genderFilter) return;
                
                const key = entry.name;
                if (!personCounts[key]) {
                    personCounts[key] = {
                        name: entry.name,
                        count: 0,
                        gender: entry.gender,
                        method: entry.method,
                        lastDate: entry.date
                    };
                }
                personCounts[key].count++;
                if (entry.date && new Date(entry.date) > new Date(personCounts[key].lastDate)) {
                    personCounts[key].lastDate = entry.date;
                }
            });

            // Convert to array and sort by count (highest first)
            const sortedPeople = Object.values(personCounts).sort((a, b) => b.count - a.count);
            
            const content = document.getElementById('fullLeaderboardContent');
            
            if (sortedPeople.length === 0) {
                content.innerHTML = '<div class="no-data">No entries match the selected filters.</div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Entries</th>
                            <th>Gender</th>
                            <th>Method</th>
                            <th>Last Entry</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedPeople.forEach((person, index) => {
                const rank = index + 1;
                let date = 'Unknown';
                if (person.lastDate) {
                    try {
                        date = new Date(person.lastDate).toLocaleDateString();
                    } catch (e) {
                        console.error('Date parsing error:', e);
                    }
                }
                const trophy = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';

                html += `
                    <tr>
                        <td><strong>${rank}</strong> ${trophy}</td>
                        <td>${person.name}</td>
                        <td><strong>${person.count}</strong></td>
                        <td>${person.gender || 'Unknown'}</td>
                        <td>${person.method || 'Unknown'}</td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            content.innerHTML = html;
        }

        function filterFullLeaderboard() {
            displayFullLeaderboard();
        }

        // Admin functions
        function showPasswordModal() {
            document.getElementById('passwordModal').style.display = 'block';
            document.getElementById('adminPassword').focus();
        }

        function closeModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                closeModal();
                showAdminSection();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        function showAdminSection() {
            document.getElementById('mainSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'block';
            displayCodes();
            displayViolations();
            displayCategoryLeaderboards();
        }

        function backToMain() {
            document.getElementById('mainSection').style.display = 'block';
            document.getElementById('adminSection').style.display = 'none';
        }

        // Display codes
        function displayCodes() {
            const codesDisplay = document.getElementById('codesDisplay');
            let html = '';
            let activeCount = 0;
            
            uniqueDailyCodes.forEach(code => {
                const isUsed = usedCodes[code];
                if (isUsed) activeCount++;
                
                let classAttr = 'code-item';
                let dataAttr = '';
                
                if (isUsed) {
                    classAttr += ' used';
                    const date = new Date(isUsed.date).toLocaleDateString();
                    const time = new Date(isUsed.date).toLocaleTimeString();
                    dataAttr = `data-used-date="${date}\n${time}"`;
                }
                
                html += `<div class="${classAttr}" ${dataAttr} onclick="toggleCode('${code}')">${code}</div>`;
            });
            
            codesDisplay.innerHTML = html;
            document.getElementById('activeCodeCount').textContent = activeCount;
        }

        async function toggleCode(code) {
            if (usedCodes[code]) {
                if (confirm(`Deactivate code ${code}?`)) {
                    delete usedCodes[code];
                    
                    // Use GET request to bypass CORS
                    try {
                        const params = new URLSearchParams({
                            action: 'toggleCode',
                            code: code,
                            isActive: 'false'
                        });
                        await fetch(`${SCRIPT_URL}?${params}`);
                    } catch (error) {
                        console.error('Error deactivating code:', error);
                    }
                    
                    displayCodes();
                }
            } else {
                usedCodes[code] = {
                    date: new Date().toISOString(),
                    activatedBy: 'Admin'
                };
                
                // Use GET request to bypass CORS
                try {
                    const params = new URLSearchParams({
                        action: 'toggleCode',
                        code: code,
                        isActive: 'true'
                    });
                    await fetch(`${SCRIPT_URL}?${params}`);
                } catch (error) {
                    console.error('Error activating code:', error);
                }
                
                displayCodes();
            }
        }

        async function clearActiveCodes() {
            if (confirm('Clear all active codes?')) {
                usedCodes = {};
                
                try {
                    await fetch(`${SCRIPT_URL}?action=clearActiveCodes`);
                } catch (error) {
                    console.error('Error clearing codes:', error);
                }
                
                displayCodes();
            }
        }

        // Display violations
        function displayViolations() {
            const violationsContent = document.getElementById('violationsContent');
            
            if (codeViolations.length === 0) {
                violationsContent.innerHTML = '<div class="no-data">No violations recorded yet.</div>';
                return;
            }

            let html = '<div class="violations-list">';
            codeViolations.forEach((violation, index) => {
                let date = 'Unknown';
                if (violation.date) {
                    try {
                        date = new Date(violation.date).toLocaleDateString();
                    } catch (e) {
                        console.error('Date parsing error:', e);
                    }
                }
                const violationType = violation.type === 'inactive' ? 'INACTIVE CODE' : 'INVALID CODE';
                
                html += `
                    <div class="violation-item">
                        <strong>#${index + 1} - ${violationType}</strong><br>
                        Name: ${violation.name || 'Unknown'}<br>
                        Code: <strong>${violation.attemptedCode || 'Unknown'}</strong><br>
                        ${date} at ${violation.time || 'Unknown'}
                    </div>
                `;
            });
            html += '</div>';
            violationsContent.innerHTML = html;
        }

        // Display category leaderboards
        function displayCategoryLeaderboards() {
            const categories = {
                maleFoot: [],
                femaleFoot: [],
                maleCycle: [],
                femaleCycle: []
            };

            const personCounts = {};
            
            leaderboardData.forEach(entry => {
                if (!entry || !entry.name) return;
                
                const key = `${entry.name}_${entry.gender}_${entry.method}`;
                if (!personCounts[key]) {
                    personCounts[key] = {
                        name: entry.name,
                        gender: entry.gender,
                        method: entry.method,
                        count: 0,
                        lastDate: entry.date
                    };
                }
                personCounts[key].count++;
                if (entry.date && new Date(entry.date) > new Date(personCounts[key].lastDate)) {
                    personCounts[key].lastDate = entry.date;
                }
            });

            Object.values(personCounts).forEach(person => {
                if (person.gender === 'Male' && person.method === 'Running') {
                    categories.maleFoot.push(person);
                } else if (person.gender === 'Female' && person.method === 'Running') {
                    categories.femaleFoot.push(person);
                } else if (person.gender === 'Male' && person.method === 'Biking') {
                    categories.maleCycle.push(person);
                } else if (person.gender === 'Female' && person.method === 'Biking') {
                    categories.femaleCycle.push(person);
                }
            });

            Object.keys(categories).forEach(cat => {
                categories[cat].sort((a, b) => b.count - a.count);
            });

            displayCategoryList('maleFoot', categories.maleFoot);
            displayCategoryList('femaleFoot', categories.femaleFoot);
            displayCategoryList('maleCycle', categories.maleCycle);
            displayCategoryList('femaleCycle', categories.femaleCycle);
        }

        function displayCategoryList(elementId, data) {
            const element = document.getElementById(elementId);
            
            if (data.length === 0) {
                element.innerHTML = '<div class="no-data">No entries yet</div>';
                return;
            }

            let html = '';
            data.slice(0, 10).forEach((person, index) => {
                html += `
                    <div class="category-entry">
                        <span>${person.name}</span>
                        <span class="entry-count">${person.count} entries</span>
                    </div>
                `;
            });

            element.innerHTML = html;
        }

        function clearAllData() {
            if (confirm('Clear all data? This cannot be undone.')) {
                leaderboardData = [];
                codeViolations = [];
                displayLeaderboard();
                updateStatistics();
                displayViolations();
            }
        }

        function exportData() {
            const exportData = {
                entries: leaderboardData,
                violations: codeViolations,
                validCodes: uniqueDailyCodes,
                activeCodes: usedCodes,
                exportDate: new Date().toISOString()
            };
            console.log('Exported Data:', exportData);
            alert('Data exported to console. Press F12 to view.');
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('passwordModal')) {
                closeModal();
            }
        }
    </script>
</body>
</html>
